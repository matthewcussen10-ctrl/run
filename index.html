<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Running Route Generator</title>
<style>
    body, html {
        margin: 0;
        padding: 0;
        font-family: 'Helvetica Neue', Arial, sans-serif;
        height: 100%;
        display: flex;
        flex-direction: column;
        background: #f7f7f7;
        overflow: hidden;
    }

    #map {
        flex: 1;
        width: 100%;
    }

    #controls {
        position: fixed;
        bottom: 0;
        width: 100%;
        background: #fff;
        box-shadow: 0 -3px 15px rgba(0,0,0,0.1);
        border-top-left-radius: 15px;
        border-top-right-radius: 15px;
        transition: max-height 0.3s ease;
        max-height: 300px;
        overflow: hidden;
    }

    #controls.collapsed { max-height: 40px; }

    #controlsHeader {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        cursor: pointer;
        font-weight: bold;
        background: #f0f0f0;
        border-top-left-radius: 15px;
        border-top-right-radius: 15px;
    }

    #controlsBody { padding: 10px 15px; display: flex; flex-direction: column; gap: 10px; }

    .control-group { display: flex; align-items: center; justify-content: space-between; }

    label { font-size: 0.9rem; margin-right: 10px; }
    input[type="range"] { width: 60%; }
    select, button { padding: 5px 10px; border-radius: 8px; border: 1px solid #ccc; background: #fff; cursor: pointer; }
    button { background: #007bff; color: #fff; border: none; font-weight: bold; transition: 0.2s; }
    button:hover { background: #0056b3; }

    #status { font-size: 0.85rem; color: #555; }
    #directionsPanel { max-height: 200px; overflow-y: auto; font-size: 0.9rem; margin-top: 5px; padding: 5px; background: #f0f0f0; border-radius: 8px; }
    #savedRoutesContainer { display: none; position: fixed; top: 50px; left: 15px; background: #fff; padding: 10px; box-shadow: 0 2px 15px rgba(0,0,0,0.2); border-radius: 10px; max-height: 300px; overflow-y: auto; }
    #savedRoutesContainer button { width: 100%; margin-top: 5px; }
    #savedRoutesBtn { position: fixed; top: 10px; left: 10px; z-index: 10; padding: 8px 12px; border-radius: 8px; background: #007bff; color: #fff; border: none; cursor: pointer; }
    #savedRoutesBtn:hover { background: #0056b3; }
</style>
</head>
<body>
<div id="map"></div>

<button id="savedRoutesBtn" onclick="toggleSavedRoutes()">Saved Routes</button>
<div id="savedRoutesContainer"></div>

<div id="controls" class="collapsed">
    <div id="controlsHeader" onclick="toggleControls()">Route Settings ⬆</div>
    <div id="controlsBody">
        <div class="control-group">
            <label>Distance (km): <span id="distanceVal">5</span></label>
            <input type="range" id="distance" min="1" max="20" step="0.1" value="5" oninput="distanceVal.innerText=this.value">
        </div>
        <div class="control-group">
            <label>Time (min): <span id="timeVal">30</span></label>
            <input type="range" id="time" min="10" max="180" step="0.1" value="30" oninput="timeVal.innerText=this.value">
        </div>
        <div class="control-group">
            <label>Pace:</label>
            <select id="pace">
                <option value="slow">Slow</option>
                <option value="moderate" selected>Moderate</option>
                <option value="fast">Fast</option>
            </select>
        </div>
        <div class="control-group">
            <label>Terrain:</label>
            <select id="terrain">
                <option value="scenic">Scenic</option>
                <option value="waterside">Waterside</option>
                <option value="hill">Hill</option>
                <option value="road" selected>Road</option>
            </select>
        </div>
        <div class="control-group">
            <label>Return route:</label>
            <select id="returnRoute">
                <option value="same" selected>Same route</option>
                <option value="different">Different route</option>
            </select>
            <button onclick="generateRoute()">Generate Route</button>
            <button onclick="saveRoute()">Save Route</button>
        </div>
        <div id="status"></div>
        <div id="directionsPanel"></div>
    </div>
</div>

<script>
let map, directionsService, directionsRenderer, userLocation, lastRoute;

function initMap() {
    map = new google.maps.Map(document.getElementById("map"), { zoom: 14 });
    directionsService = new google.maps.DirectionsService();
    directionsRenderer = new google.maps.DirectionsRenderer({ map: map, panel: document.getElementById("directionsPanel") });

    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            pos => {
                userLocation = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                map.setCenter(userLocation);
                new google.maps.Marker({ position: userLocation, map: map, title: "Your Location" });
            },
            () => { document.getElementById("status").innerText = "Geolocation failed."; }
        );
    } else {
        document.getElementById("status").innerText = "Geolocation not supported.";
    }

    loadSavedRoutes();
}

function toggleControls() {
    const controls = document.getElementById("controls");
    controls.classList.toggle("collapsed");
    document.getElementById("controlsHeader").innerText = controls.classList.contains("collapsed") ? "Route Settings ⬇" : "Route Settings ⬆";
}

function generateWaypoints(distanceKm, terrain) {
    const delta = distanceKm / 4 / 111;
    let waypoints = [];
    for (let i = 0; i < 3; i++) {
        let latOffset = (Math.random() - 0.5) * delta * 2;
        let lngOffset = (Math.random() - 0.5) * delta * 2;
        if (terrain === "waterside") { latOffset += 0.001; lngOffset += 0.001; }
        else if (terrain === "hill") { latOffset += 0.002; lngOffset -= 0.002; }
        else if (terrain === "scenic") { latOffset += 0.0015; lngOffset += 0.002; }
        waypoints.push({ location: { lat: userLocation.lat + latOffset, lng: userLocation.lng + lngOffset }, stopover: true });
    }
    return waypoints;
}

function generateRoute() {
    if (!userLocation) { alert("Waiting for location..."); return; }

    const distanceKm = parseFloat(document.getElementById("distance").value);
    const pace = document.getElementById("pace").value;
    const terrain = document.getElementById("terrain").value;
    const returnOption = document.getElementById("returnRoute").value;

    let waypoints = generateWaypoints(distanceKm, terrain);
    if (returnOption === "same") waypoints.push({ location: userLocation, stopover: true });

    directionsService.route({
        origin: userLocation,
        destination: userLocation,
        travelMode: 'WALKING',
        waypoints: waypoints
    }, (result, status) => {
        if (status === 'OK') {
            directionsRenderer.setDirections(result);
            lastRoute = result;
            document.getElementById("status").innerText = `Route: ${distanceKm}km, Pace: ${pace}, Terrain: ${terrain}`;
        } else { alert("Route generation failed: " + status); }
    });
}

function saveRoute() {
    if (!lastRoute) { alert("Generate a route first."); return; }
    let saved = JSON.parse(localStorage.getItem("savedRoutes") || "[]");
    saved.push(lastRoute);
    localStorage.setItem("savedRoutes", JSON.stringify(saved));
    loadSavedRoutes();
    alert("Route saved!");
}

function loadSavedRoutes() {
    const container = document.getElementById("savedRoutesContainer");
    container.innerHTML = "<strong>Saved Routes:</strong>";
    let saved = JSON.parse(localStorage.getItem("savedRoutes") || "[]");
    saved.forEach((route, idx) => {
        const btn = document.createElement("button");
        btn.textContent = `Route ${idx + 1}`;
        btn.onclick = () => { directionsRenderer.setDirections(route); lastRoute = route; };
        container.appendChild(btn);
    });
}

function toggleSavedRoutes() {
    const container = document.getElementById("savedRoutesContainer");
    container.style.display = container.style.display === "none" ? "block" : "none";
}
</script>

<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAPgzqvSqNMXp3jxTLh4TbyT0IwJd46dbA&callback=initMap">
</script>
</body>
</html>
